<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smart Anki Dashboard</title>
    <link rel="stylesheet" href="/static/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <!-- Ionicons for beautiful icons -->
    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>
  </head>
  <body>
    <!-- Subtle Background (Minimal) -->
    <div class="app-background"></div>

    <div class="app-container">
      <!-- SIDEBAR -->
      <div class="sidebar">
        <div class="brand">
          <ion-icon name="flash"></ion-icon>
          <span>AnkiFlow</span>
        </div>

        <div class="sidebar-section">
          <h3>My Decks</h3>
          <ul class="deck-list" id="deckList">
            <!-- Decks injected here -->
          </ul>
          <button class="new-deck-btn" id="btnNewDeck">
            <ion-icon name="add-circle"></ion-icon> New Deck
          </button>
          
          <button class="menu-btn" id="btnOpenStats" style="margin-top: 12px; width: 100%; text-align: left; background: transparent; color: var(--text-secondary); border: 1px solid var(--border-subtle); padding: 8px 12px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
            <ion-icon name="pie-chart-outline"></ion-icon> Statistics
          </button>
        </div>

        <div class="sidebar-footer">
          <div class="status-indicator online">
            <span class="dot"></span> System Ready
          </div>
        </div>
      </div>

      <!-- MAIN WORKSPACE -->
      <div class="main-content">
        <!-- TOP BAR (Omnibar) -->
        <div class="top-bar">
          <div class="omnibar-container" id="omnibarContainer">
              <div class="omnibar-icon clickable" id="omnibarIcon" title="Click to upload file">
                <ion-icon name="cloud-upload-outline"></ion-icon>
              </div>
            <input
              type="text"
              id="omnibarInput"
              placeholder="Type word - def, paste text, or drag files here..."
              autocomplete="off"
            />
            <div class="omnibar-actions">
              <div class="md-toolbar">
                  <button class="md-btn" title="Bold (Ctrl+B)" data-md="**"><b>B</b></button>
                  <button class="md-btn" title="Italic (Ctrl+I)" data-md="*"><i>I</i></button>
                  <button class="md-btn" title="Code (Ctrl+`)" data-md="\`">&lt;/&gt;</button>
              </div>
              <span class="key-hint">ENTER</span>
            </div>
            <!-- Hidden File Input for Drag & Drop / Click -->
            <input
              type="file"
              id="fileInput"
              class="hidden"
              accept=".txt,.csv,.docx"
            />
            <!-- Command Palette Dropdown -->
            <div id="commandDropdown" class="command-dropdown hidden"></div>
          </div>
        </div>

        <!-- TAB NAVIGATION -->
        <div class="tab-navigation">
          <button class="nav-tab active" data-view="library">
            <ion-icon name="library-outline"></ion-icon>
            <span>Library</span>
          </button>
          <button class="nav-tab" data-view="study">
            <ion-icon name="book-outline"></ion-icon>
            <span>Study</span>
          </button>
          <button class="nav-tab" data-view="statistics">
            <ion-icon name="bar-chart-outline"></ion-icon>
            <span>Statistics</span>
          </button>
          <button class="nav-tab" data-view="settings">
            <ion-icon name="settings-outline"></ion-icon>
            <span>Settings</span>
          </button>
        </div>

        <!-- LIBRARY VIEW -->
        <div id="view-library" class="view-container">
        <!-- WORKSPACE AREA -->
        <div class="workspace">
          <div class="deck-header">
            <h1 id="currentDeckTitle">My Vocabulary</h1>
            
            <!-- Search Input -->
            <div class="search-container">
              <ion-icon name="search-outline" class="search-icon"></ion-icon>
              <input 
                type="text" 
                id="searchInput" 
                placeholder="Search cards..." 
                autocomplete="off"
              />
              <button class="search-clear hidden" id="btnClearSearch">
                <ion-icon name="close-outline"></ion-icon>
              </button>
            </div>
            
            <div class="deck-actions-header">
                <button class="action-btn primary" id="btnStudyDeck">
                    <ion-icon name="play-circle-outline"></ion-icon> Study
                </button>
            </div>
            <div class="deck-stats">
              <span class="stat-badge"
                ><span id="countTotal">0</span> Items</span
              >
              <span class="stat-badge warning hidden" id="countIssues"
                >0 Issues</span
              >
            </div>
          </div>

          <div class="table-container">
            <table class="live-table" id="cardTable">
              <thead>
                <tr>
                  <th style="width: 40px">
                      <input type="checkbox" id="selectAllCheckbox">
                  </th>
                  <th>Term</th>
                  <th>Definition</th>
                  <th>Tags</th>
                  <th style="width: 50px"></th>
                </tr>
              </thead>
              <tbody id="tableBody">
                <!-- Rows injected here -->
                <!-- Empty State -->
                <tr class="empty-state" id="emptyState">
                  <td colspan="5">
                    <div class="empty-content">
                      <ion-icon name="library-outline"></ion-icon>
                      <p>Start typing or drag a file to begin.</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        </div> <!-- End Library View -->

        <!-- STUDY VIEW -->
        <div id="view-study" class="view-container hidden">
          <div class="workspace">
            <div class="deck-header">
              <h1>Study Session</h1>
              <p style="color: var(--text-secondary); margin-top: 8px;">Select a deck from the sidebar and click "Study" to begin</p>
            </div>
          </div>
        </div>

        <!-- STATISTICS VIEW -->
        <div id="view-statistics" class="view-container hidden">
          <div class="workspace">
            <div class="deck-header">
              <h1>Statistics</h1>
            </div>
            <div style="padding: 24px;">
              <p style="color: var(--text-secondary);">Loading statistics dashboard...</p>
            </div>
          </div>
        </div>

        <!-- SETTINGS VIEW -->
        <div id="view-settings" class="view-container hidden">
          <div class="workspace">
            <div class="deck-header">
              <h1>Settings</h1>
            </div>
            <div style="padding: 24px;">
              <div style="max-width: 600px;">
                <h3 style="margin-bottom: 16px; color: var(--text-primary);">Appearance</h3>
                <div style="padding: 20px; background: var(--bg-surface); border-radius: 12px; border: 1px solid var(--border-color);">
                  <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">Choose your preferred theme</p>
                  <div id="themeOptions" style="display: flex; flex-direction: column; gap: 12px;">
                    <!-- Theme options will be populated by JavaScript -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>



        <!-- BULK ACTION BAR (Floating) -->
        <div id="bulkActionBar" class="bulk-bar hidden">
            <div class="bulk-info">
                <span id="bulkCount">0</span> selected
            </div>
            <div class="bulk-actions">
                <button class="action-btn secondary small" id="btnBulkTag">
                    <ion-icon name="pricetag-outline"></ion-icon> Tag
                </button>
                <button class="action-btn danger small" id="btnBulkDelete">
                    <ion-icon name="trash-outline"></ion-icon> Delete
                </button>
                <button class="icon-btn" id="btnBulkCancel">
                    <ion-icon name="close"></ion-icon>
                </button>
            </div>
        </div>
      </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="toast hidden">Action Successful</div>

    <!-- EXPORT MODAL (Hidden by default) -->
    <div id="exportModal" class="modal-overlay hidden">
        <div class="modal-glass">
            <h2>Export Deck</h2>
            <div class="form-group">
                <label>Filename</label>
                <input type="text" id="exportFilename" value="my_deck" />
            </div>
            
            <div class="form-group">
                <label>Format</label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="exportFormat" value="apkg" checked>
                        <span>Anki Package (.apkg)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="exportFormat" value="txt">
                        <span>Text File (.txt)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="exportFormat" value="md">
                        <span>Markdown (.md)</span>
                    </label>
                </div>
            </div>

            <div class="modal-actions">
                <button class="action-btn secondary" id="btnCancelExport">
                    Cancel
                </button>
                <button class="action-btn secondary" id="btnPreviewExport">
                    Preview
                </button>
                <button class="action-btn primary" id="btnConfirmExport">
                    Download .apkg
                </button>
            </div>
            <div id="exportLoader" class="loader-line hidden"></div>
        </div>
    </div>

    <!-- EXPORT PREVIEW MODAL -->
    <div id="exportPreviewModal" class="modal-overlay hidden">
      <div class="modal-glass" style="max-width: 700px;">
        <h2>Export Preview</h2>
        <div class="preview-stats">
          <div class="stat-item">
            <ion-icon name="library-outline"></ion-icon>
            <div>
              <strong id="previewTotalCards">0</strong>
              <span>Total Cards</span>
            </div>
          </div>
          <div class="stat-item">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            <div>
              <strong id="previewValidCards">0</strong>
              <span>Valid Cards</span>
            </div>
          </div>
          <div class="stat-item warning">
            <ion-icon name="alert-circle-outline"></ion-icon>
            <div>
              <strong id="previewIssues">0</strong>
              <span>Issues</span>
            </div>
          </div>
        </div>
        
        <h3 style="margin-top: 24px; margin-bottom: 12px; font-size: 16px;">Sample Cards (First 5)</h3>
        <div class="preview-cards" id="previewCardsList"></div>
        
        <div class="modal-actions">
          <button class="action-btn secondary" id="btnClosePreview">Close</button>
          <button class="action-btn primary" id="btnConfirmFromPreview">Looks Good - Export</button>
        </div>
      </div>
    </div>

    <!-- KEYBOARD SHORTCUTS MODAL -->
    <div id="shortcutsModal" class="modal-overlay hidden">
      <div class="modal-glass">
        <h2>Keyboard Shortcuts</h2>
        <div class="shortcuts-table">
          <div class="shortcuts-section">
            <h3>Navigation</h3>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>F1</kbd></span>
              <span class="shortcut-desc">Open command palette</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Esc</kbd></span>
              <span class="shortcut-desc">Close modals / Clear command palette</span>
            </div>
          </div>
          
          <div class="shortcuts-section">
            <h3>Editing</h3>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Enter</kbd></span>
              <span class="shortcut-desc">Add card from omnibar</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>Z</kbd></span>
              <span class="shortcut-desc">Undo last action</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>Z</kbd></span>
              <span class="shortcut-desc">Redo action</span>
            </div>
          </div>
          
          <div class="shortcuts-section">
            <h3>Help</h3>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>/</kbd></span>
              <span class="shortcut-desc">Show this help panel</span>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="action-btn primary" id="btnCloseShortcuts">Close</button>
        </div>
      </div>
    </div>

    <!-- COLOR PICKER MODAL -->
    <div id="colorPickerModal" class="modal-overlay hidden">
      <div class="modal-glass">
        <h2>Choose Deck Color</h2>
        <div class="color-grid">
          <button class="color-option" data-color="#6366F1" style="background: #6366F1"></button>
          <button class="color-option" data-color="#8B5CF6" style="background: #8B5CF6"></button>
          <button class="color-option" data-color="#EC4899" style="background: #EC4899"></button>
          <button class="color-option" data-color="#F43F5E" style="background: #F43F5E"></button>
          <button class="color-option" data-color="#F97316" style="background: #F97316"></button>
          <button class="color-option" data-color="#F59E0B" style="background: #F59E0B"></button>
          <button class="color-option" data-color="#84CC16" style="background: #84CC16"></button>
          <button class="color-option" data-color="#10B981" style="background: #10B981"></button>
          <button class="color-option" data-color="#14B8A6" style="background: #14B8A6"></button>
          <button class="color-option" data-color="#06B6D4" style="background: #06B6D4"></button>
          <button class="color-option" data-color="#3B82F6" style="background: #3B82F6"></button>
          <button class="color-option" data-color="#6366F1" style="background: #6366F1"></button>
        </div>
        <div class="modal-actions">
          <button class="action-btn secondary" id="btnCancelColor">Cancel</button>
        </div>
      </div>
    </div>

    <!-- GENERIC CUSTOM MODAL -->
    <div id="customModal" class="modal-overlay hidden">
      <div class="modal-glass">
        <h2 id="customModalTitle">Title</h2>
        <div id="customModalContent" class="modal-content"></div>
        <div class="form-group hidden" id="customModalInputContainer">
            <input type="text" id="customModalInput" class="modal-input" autocomplete="off">
        </div>
        <div class="modal-actions">
          <button class="action-btn secondary" id="btnModalCancel">Cancel</button>
          <button class="action-btn primary" id="btnModalConfirm">Confirm</button>
        </div>
      </div>
    </div>

    <!-- Import Preview Modal -->
    <div id="importPreviewModal" class="modal hidden">
      <div class="preview-modal-content">
        <h2>ðŸ“¥ Import Preview</h2>
        
        <div class="import-stats">
          <span>Total: <strong id="importTotal">0</strong> cards</span>
        </div>
        
        <!-- Column Mapping (CSV only) -->
        <div id="columnMapping" class="hidden">
          <h3>Column Mapping</h3>
          <div class="mapping-controls">
            <div class="mapping-row">
              <label>Term Column:</label>
              <select id="termColumnSelect"></select>
            </div>
            <div class="mapping-row">
              <label>Definition Column:</label>
              <select id="defColumnSelect"></select>
            </div>
          </div>
        </div>
        
        <!-- Preview List -->
        <div class="import-preview-section">
          <h3>Preview (first 10 cards)</h3>
          <div class="import-preview-list" id="importPreviewList">
            <!-- Cards preview here -->
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="action-btn secondary" id="btnCancelImport">Cancel</button>
          <button class="action-btn primary" id="btnConfirmImport">Import Cards</button>
        </div>
      </div>
    </div>

    <!-- STUDY MODE MODAL -->
    <div id="studyModal" class="modal-overlay hidden">
        <div class="study-container">
            <div class="study-header">
                <div class="study-progress">
                    <span id="studyindex">1</span> / <span id="studyTotal">10</span>
                </div>
                <button class="icon-btn" id="btnCloseStudy">
                    <ion-icon name="close"></ion-icon>
                </button>
            </div>
            
            <div class="flashcard-area" id="flashcard">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <div class="card-label">TERM</div>
                        <div class="card-content" id="studyFront">Apple</div>
                        <div class="hint-text">Click to Flip</div>
                    </div>
                    <div class="flashcard-back">
                        <div class="card-label">DEFINITION</div>
                        <div class="card-content" id="studyBack">Olma</div>
                    </div>
                </div>
            </div>


            <div class="study-controls">
                <!-- Show Answer Button (hidden after answer shown) -->
                 <button class="action-btn primary large" id="btnStudyFlip">
                    Show Answer (Space)
                </button>
                
                <!-- Rating Buttons (hidden until answer shown) -->
                <div class="study-rating-buttons hidden">
                    <button class="rating-btn rating-again" id="btnAgain">
                        <ion-icon name="close-circle"></ion-icon> Again (1d)
                    </button>
                    <button class="rating-btn rating-hard" id="btnHard">
                        <ion-icon name="sad-outline"></ion-icon> Hard (6d)
                    </button>
                    <button class="rating-btn rating-good" id="btnGood">
                        <ion-icon name="checkmark-circle"></ion-icon> Good (1d)
                    </button>
                    <button class="rating-btn rating-easy" id="btnEasy">
                        <ion-icon name="happy-outline"></ion-icon> Easy (4d)
                    </button>
                </div>
                
                <!-- Keep prev/next hidden for now (SRS mode) -->
                <button class="action-btn secondary hidden" id="btnStudyPrev">
                    <ion-icon name="arrow-back"></ion-icon> Prev
                </button>
                <button class="action-btn secondary hidden" id="btnStudyNext">
                    Next <ion-icon name="arrow-forward"></ion-icon>
                </button>
            </div>
        </div>
    </div>

    <!-- STATS MODAL -->
    <div id="statsModal" class="modal-overlay hidden">
        <div class="modal-glass" style="max-width: 600px;">
            <h2>Statistics</h2>
            
            <div class="stats-overview">
                <div class="stat-box">
                    <div class="stat-value" id="statTotalCards">0</div>
                    <div class="stat-label">Total Cards</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="statTotalDecks">0</div>
                    <div class="stat-label">Total Decks</div>
                </div>
            </div>

            <div class="stats-section">
                <h3>Deck Distribution</h3>
                <div id="statDeckChart" class="chart-container">
                    <!-- Bars injected here -->
                </div>
            </div>

            <div class="stats-section">
                <h3>Top Tags</h3>
                <div id="statTagCloud" class="tag-cloud">
                    <!-- Tags injected here -->
                </div>
            </div>

            <div class="modal-actions">
                <button class="action-btn primary" id="btnCloseStats">Close</button>
            </div>
        </div>
    </div>

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    
    <!-- Application Logic -->
    <script type="module" src="/static/js/main.js"></script>
  </body>
</html>
