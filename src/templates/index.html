<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="AnkiFlow â€” Smart flashcard study platform with spaced repetition" />
    <meta name="theme-color" content="#6366F1" />
    <meta property="og:title" content="AnkiFlow" />
    <meta property="og:description" content="Smart flashcard study platform with spaced repetition" />
    <title>AnkiFlow</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš¡</text></svg>">
    <link rel="stylesheet" href="/static/style.css?v=6.0" />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <!-- Ionicons for beautiful icons -->
    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>
  </head>
  <body>
    <noscript>
      <div style="display:flex;justify-content:center;align-items:center;height:100vh;font-size:18px;color:#888;text-align:center;padding:20px;">
        AnkiFlow requires JavaScript to run. Please enable JavaScript in your browser.
      </div>
    </noscript>
    <!-- Subtle Background (Minimal) -->
    <div class="app-background"></div>

    <!-- Loading Skeleton -->
    <div id="appSkeleton" class="app-skeleton">
      <div class="skeleton-sidebar">
        <div class="skeleton-line w60"></div>
        <div class="skeleton-line w80"></div>
        <div class="skeleton-line w40"></div>
        <div class="skeleton-line w70"></div>
      </div>
      <div class="skeleton-main">
        <div class="skeleton-topbar"></div>
        <div class="skeleton-content">
          <div class="skeleton-line w50"></div>
          <div class="skeleton-rect"></div>
          <div class="skeleton-line w80"></div>
          <div class="skeleton-line w60"></div>
        </div>
      </div>
    </div>

    <div class="app-container" id="appContainer" style="display:none;">
      <!-- Mobile Hamburger -->
      <button class="hamburger-btn" id="hamburgerBtn">
        <ion-icon name="menu-outline"></ion-icon>
      </button>
      <div class="sidebar-overlay" id="sidebarOverlay"></div>

      <!-- SIDEBAR -->
      <div class="sidebar" id="sidebar">
        <div class="brand">
          <ion-icon name="flash"></ion-icon>
          <span>AnkiFlow</span>
          <button class="sidebar-close-btn" id="sidebarCloseBtn">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>

        <div class="sidebar-section">
          <h3>My Decks</h3>
          <ul class="deck-list" id="deckList">
            <!-- Decks injected here -->
          </ul>
          <button class="new-deck-btn" id="btnNewDeck">
            <ion-icon name="add-circle"></ion-icon> New Deck
          </button>
          
          <button class="sidebar-stats-btn" id="btnOpenStats">
            <ion-icon name="pie-chart-outline"></ion-icon> Statistics
          </button>
        </div>

        <div class="sidebar-footer">
          <!-- Daily Goal & Streak -->
          <div class="daily-goal-widget" id="dailyGoalWidget">
            <div class="goal-progress">
              <div class="goal-progress-bar" id="goalProgressBar" style="width: 0%"></div>
            </div>
            <div class="goal-info">
              <span class="goal-text" id="goalText">0 / 20 cards today</span>
              <span class="streak-badge" id="streakBadge">ðŸ”¥ 0</span>
            </div>
          </div>
          <div class="status-indicator online">
            <span class="dot"></span> <span id="autoSaveText">System Ready</span>
          </div>
        </div>
      </div>

      <!-- MAIN WORKSPACE -->
      <div class="main-content">
        <!-- TOP BAR (Omnibar) -->
        <div class="top-bar">
          <div class="omnibar-container" id="omnibarContainer">
              <div class="omnibar-icon clickable" id="omnibarIcon" title="Click to upload file">
                <ion-icon name="cloud-upload-outline"></ion-icon>
              </div>
            <input
              type="text"
              id="omnibarInput"
              placeholder="Type word - def, paste text, or drag files here..."
              autocomplete="off"
            />
            <div class="omnibar-actions">
              <div class="md-toolbar">
                  <button class="md-btn" title="Bold (Ctrl+B)" data-md="**"><b>B</b></button>
                  <button class="md-btn" title="Italic (Ctrl+I)" data-md="*"><i>I</i></button>
                  <button class="md-btn" title="Code (Ctrl+`)" data-md="\`">&lt;/&gt;</button>
              </div>
              <span class="key-hint">ENTER</span>
            </div>
            <!-- Hidden File Input for Drag & Drop / Click -->
            <input
              type="file"
              id="fileInput"
              class="hidden"
              accept=".txt,.csv,.docx"
            />
            <!-- Command Palette Dropdown -->
            <div id="commandDropdown" class="command-dropdown hidden"></div>
            <!-- Markdown Live Preview -->
            <div id="omnibarPreview" class="omnibar-preview hidden"></div>
          </div>
        </div>

        <!-- TAB NAVIGATION -->
        <div class="tab-navigation">
          <button class="nav-tab active" data-view="library">
            <ion-icon name="library-outline"></ion-icon>
            <span>Library</span>
          </button>
          <button class="nav-tab" data-view="study">
            <ion-icon name="book-outline"></ion-icon>
            <span>Study</span>
          </button>
          <button class="nav-tab" data-view="statistics">
            <ion-icon name="bar-chart-outline"></ion-icon>
            <span>Statistics</span>
          </button>
          <button class="nav-tab" data-view="settings">
            <ion-icon name="settings-outline"></ion-icon>
            <span>Settings</span>
          </button>
        </div>

        <!-- LIBRARY VIEW -->
        <div id="view-library" class="view-container">
        <!-- WORKSPACE AREA -->
        <div class="workspace">
          <div class="deck-header">
            <h1 id="currentDeckTitle">My Vocabulary</h1>
            
            <!-- Search Input -->
            <div class="search-container">
              <ion-icon name="search-outline" class="search-icon"></ion-icon>
              <input 
                type="text" 
                id="searchInput" 
                placeholder="Search cards..." 
                autocomplete="off"
              />
              <button class="search-clear hidden" id="btnClearSearch">
                <ion-icon name="close-outline"></ion-icon>
              </button>
            </div>
            
            <div class="deck-actions-header">
                <button class="action-btn secondary" id="btnFindReplace" title="Find & Replace">
                    <ion-icon name="search-outline"></ion-icon> <span class="btn-text">Find & Replace</span>
                </button>
                <button class="action-btn secondary" id="btnImportCards">
                    <ion-icon name="cloud-upload-outline"></ion-icon> <span class="btn-text">Import</span>
                </button>
                <button class="action-btn secondary" id="btnExportDeck">
                    <ion-icon name="download-outline"></ion-icon> <span class="btn-text">Export</span>
                </button>
                <button class="action-btn primary" id="btnStudyDeck">
                    <ion-icon name="play-circle-outline"></ion-icon> <span class="btn-text">Study</span>
                </button>
            </div>
            <div class="deck-stats">
              <span class="stat-badge"
                ><span id="countTotal">0</span> Items</span
              >
              <span class="stat-badge warning hidden" id="countIssues"
                >0 Issues</span
              >
            </div>
          </div>

          <div class="table-container">
            <table class="live-table" id="cardTable">
              <thead>
                <tr>
                  <th style="width: 40px">
                      <input type="checkbox" id="selectAllCheckbox">
                  </th>
                  <th>Term</th>
                  <th>Definition</th>
                  <th>Tags</th>
                  <th style="width: 50px"></th>
                </tr>
              </thead>
              <tbody id="tableBody">
                <!-- Rows injected here -->
                <!-- Empty State -->
                <tr class="empty-state" id="emptyState">
                  <td colspan="5">
                    <div class="empty-content">
                      <ion-icon name="library-outline"></ion-icon>
                      <p>Start typing or drag a file to begin.</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        </div> <!-- End Library View -->

        <!-- STUDY VIEW -->
        <div id="view-study" class="view-container hidden">
          <div class="workspace study-workspace">
            <div class="deck-header">
              <h1 id="studyDeckTitle">Study Session</h1>
              <div class="header-actions">
                 <div class="study-progress-pill">
                    <span id="studyIndex">0</span> / <span id="studyTotal">0</span>
                 </div>
              </div>
            </div>
            
            <!-- Study Progress Bar -->
            <div class="study-progress-container" id="studyProgressContainer">
              <div class="study-progress-bar-outer">
                <div class="study-progress-bar-inner" id="studyProgressBar"></div>
              </div>
              <div class="study-progress-info">
                <span id="studyProgressText">0 / 0</span>
                <span id="studyProgressPercent">0%</span>
              </div>
            </div>

            <div class="study-view-container">
                <div id="studyPlaceholder" class="study-placeholder">
                    <div class="placeholder-icon">ðŸ“š</div>
                    <h3>Start Studying</h3>
                    <p>Select a deck from the Library to begin reviewing cards.</p>
                </div>

                <!-- Session Summary (shown at end) -->
                <div id="sessionSummary" class="session-summary hidden">
                  <div class="summary-icon">ðŸŽ‰</div>
                  <h2>Session Complete!</h2>
                  <p class="summary-subtitle" id="summarySubtitle">You reviewed 0 cards</p>
                  <div class="summary-grid">
                    <div class="summary-stat again">
                      <div class="summary-stat-value" id="summaryAgain">0</div>
                      <div class="summary-stat-label">Again</div>
                    </div>
                    <div class="summary-stat hard">
                      <div class="summary-stat-value" id="summaryHard">0</div>
                      <div class="summary-stat-label">Hard</div>
                    </div>
                    <div class="summary-stat good">
                      <div class="summary-stat-value" id="summaryGood">0</div>
                      <div class="summary-stat-label">Good</div>
                    </div>
                    <div class="summary-stat easy">
                      <div class="summary-stat-value" id="summaryEasy">0</div>
                      <div class="summary-stat-label">Easy</div>
                    </div>
                  </div>
                  <div class="summary-accuracy">
                    <div class="accuracy-ring" id="accuracyRing">
                      <svg viewBox="0 0 36 36">
                        <path class="ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="ring-fg" id="accuracyPath" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                      </svg>
                      <span class="accuracy-text" id="accuracyText">0%</span>
                    </div>
                    <span class="accuracy-label">Accuracy</span>
                  </div>
                  <div class="summary-actions">
                    <button class="action-btn secondary" id="btnBackToLibrary">Back to Library</button>
                    <button class="action-btn primary" id="btnStudyAgain">Study Again</button>
                  </div>
                </div>

                <div id="studyInterface" class="study-interface hidden">
                    <div class="flashcard-area" id="flashcard">
                        <div class="flashcard-inner">
                            <div class="flashcard-front">
                                <div class="card-label">TERM</div>
                                <div class="card-content" id="studyFront"></div>
                                <div class="hint-text">Click to Flip (Space)</div>
                            </div>
                            <div class="flashcard-back">
                                <div class="card-label">DEFINITION</div>
                                <div class="card-content" id="studyBack"></div>
                            </div>
                        </div>
                    </div>

                    <div class="study-controls">
                        <!-- Show Answer Button (hidden after answer shown) -->
                         <button class="action-btn primary large" id="btnStudyFlip">
                            Show Answer (Space)
                        </button>
                        
                        <!-- Rating Buttons (hidden until answer shown) -->
                        <div class="study-rating-buttons hidden">
                            <button class="rating-btn rating-again" id="btnAgain">
                                <ion-icon name="close-circle"></ion-icon> Again
                                <kbd class="rating-kbd">1</kbd>
                            </button>
                            <button class="rating-btn rating-hard" id="btnHard">
                                <ion-icon name="sad-outline"></ion-icon> Hard
                                <kbd class="rating-kbd">2</kbd>
                            </button>
                            <button class="rating-btn rating-good" id="btnGood">
                                <ion-icon name="checkmark-circle"></ion-icon> Good
                                <kbd class="rating-kbd">3</kbd>
                            </button>
                            <button class="rating-btn rating-easy" id="btnEasy">
                                <ion-icon name="happy-outline"></ion-icon> Easy
                                <kbd class="rating-kbd">4</kbd>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
          </div>
        </div>

        <!-- STATISTICS VIEW -->
        <div id="view-statistics" class="view-container hidden">
          <div class="workspace">
            <div class="deck-header">
              <h1>Statistics</h1>
            </div>
            <div class="view-content">
              <!-- Overview Stats -->
              <div class="stats-grid">
                <div class="overview-card">
                  <div class="overview-label">Total Cards</div>
                  <div class="overview-value" id="tabStatTotalCards">0</div>
                </div>
                <div class="overview-card">
                  <div class="overview-label">Total Decks</div>
                  <div class="overview-value" id="tabStatTotalDecks">0</div>
                </div>
              </div>
              
              <!-- Enhanced Stats Grid -->
              <div id="tabEnhancedStats" class="stats-enhanced"></div>
              
              <!-- Deck Distribution -->
              <div class="stats-section-block">
                <h3 class="section-title">Deck Distribution</h3>
                <div id="tabStatDeckChart" class="stats-card"></div>
              </div>
              
              <!-- Deck Maturity -->
              <div class="stats-section-block">
                <h3 class="section-title">Card Maturity</h3>
                <div id="tabStatMaturity" class="stats-card"></div>
              </div>
              
              <!-- Review Heatmap -->
              <div class="stats-section-block">
                <h3 class="section-title">Review Activity</h3>
                <div id="tabStatHeatmap" class="stats-card"></div>
              </div>
              
              <!-- Review Forecast -->
              <div class="stats-section-block">
                <h3 class="section-title">Upcoming Reviews</h3>
                <div id="tabStatForecast" class="stats-card"></div>
              </div>
              
              <!-- Per-Deck Stats -->
              <div class="stats-section-block">
                <h3 class="section-title">Per-Deck Breakdown</h3>
                <div id="tabStatPerDeck" class="stats-card"></div>
              </div>
              
              <!-- Top Tags -->
              <div class="stats-section-block">
                <h3 class="section-title">Top Tags</h3>
                <div id="tabStatTagCloud" class="stats-card tag-cloud-grid"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- SETTINGS VIEW -->
        <div id="view-settings" class="view-container hidden">
          <div class="workspace">
            <div class="deck-header">
              <h1>Settings</h1>
            </div>
            <div class="view-content">
              <div class="settings-container">
                <!-- Appearance -->
                <h3 class="section-title">Appearance</h3>
                <div class="settings-card">
                  <p class="settings-desc">Choose your preferred theme</p>
                  <div id="themeOptions" class="theme-options-list"></div>
                </div>

                <!-- Study Settings -->
                <h3 class="section-title" style="margin-top:24px;">Study</h3>
                <div class="settings-card">
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Daily new cards</span>
                      <span class="settings-sublabel">Maximum new cards per day</span>
                    </div>
                    <input type="number" class="settings-input" id="settingNewCards" min="1" max="100" value="20">
                  </div>
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Max reviews per session</span>
                      <span class="settings-sublabel">Limit review cards per session</span>
                    </div>
                    <input type="number" class="settings-input" id="settingMaxReviews" min="10" max="500" value="100">
                  </div>
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Daily study goal</span>
                      <span class="settings-sublabel">Target cards to review per day</span>
                    </div>
                    <input type="number" class="settings-input" id="settingDailyGoal" min="1" max="200" value="20">
                  </div>
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Reverse mode</span>
                      <span class="settings-sublabel">Show definition first, guess the term</span>
                    </div>
                    <label class="toggle-switch">
                      <input type="checkbox" id="settingReverseMode">
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                </div>

                <!-- SRS Settings -->
                <h3 class="section-title" style="margin-top:24px;">Spaced Repetition</h3>
                <div class="settings-card">
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Interval modifier</span>
                      <span class="settings-sublabel">Multiply all intervals by this value (100% = default)</span>
                    </div>
                    <div class="settings-range-group">
                      <input type="range" class="settings-range" id="settingIntervalMod" min="50" max="200" value="100">
                      <span class="settings-range-value" id="intervalModValue">100%</span>
                    </div>
                  </div>
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Learning steps (minutes)</span>
                      <span class="settings-sublabel">Steps for new cards (comma separated)</span>
                    </div>
                    <input type="text" class="settings-input wide" id="settingLearningSteps" value="1, 10">
                  </div>
                </div>

                <!-- Display -->
                <h3 class="section-title" style="margin-top:24px;">Display</h3>
                <div class="settings-card">
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Card font size</span>
                      <span class="settings-sublabel">Flashcard text size during study</span>
                    </div>
                    <div class="settings-range-group">
                      <input type="range" class="settings-range" id="settingFontSize" min="16" max="48" value="32">
                      <span class="settings-range-value" id="fontSizeValue">32px</span>
                    </div>
                  </div>
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Sound effects</span>
                      <span class="settings-sublabel">Play sounds on card flip and rating</span>
                    </div>
                    <label class="toggle-switch">
                      <input type="checkbox" id="settingSoundEffects">
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Show keyboard hints</span>
                      <span class="settings-sublabel">Display shortcut keys on buttons</span>
                    </div>
                    <label class="toggle-switch">
                      <input type="checkbox" id="settingKeyboardHints" checked>
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                </div>

                <!-- Data -->
                <h3 class="section-title" style="margin-top:24px;">Data</h3>
                <div class="settings-card">
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Export all data</span>
                      <span class="settings-sublabel">Download all decks as JSON backup</span>
                    </div>
                    <button class="action-btn secondary small" id="btnExportAllData">
                      <ion-icon name="download-outline"></ion-icon> Export
                    </button>
                  </div>
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Import backup</span>
                      <span class="settings-sublabel">Restore from a JSON backup file</span>
                    </div>
                    <button class="action-btn secondary small" id="btnImportBackup">
                      <ion-icon name="cloud-upload-outline"></ion-icon> Import
                    </button>
                    <input type="file" id="backupFileInput" accept=".json" style="display:none">
                  </div>
                  <div class="settings-row">
                    <div class="settings-row-info">
                      <span class="settings-label">Reset all data</span>
                      <span class="settings-sublabel">Delete all decks and cards permanently</span>
                    </div>
                    <button class="action-btn danger small" id="btnResetAllData">
                      <ion-icon name="trash-outline"></ion-icon> Reset
                    </button>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>



        <!-- BULK ACTION BAR (Floating) -->
        <div id="bulkActionBar" class="bulk-bar hidden">
            <div class="bulk-info">
                <span id="bulkCount">0</span> selected
            </div>
            <div class="bulk-actions">
                <button class="action-btn secondary small" id="btnBulkTag">
                    <ion-icon name="pricetag-outline"></ion-icon> Tag
                </button>
                <button class="action-btn danger small" id="btnBulkDelete">
                    <ion-icon name="trash-outline"></ion-icon> Delete
                </button>
                <button class="icon-btn" id="btnBulkCancel">
                    <ion-icon name="close"></ion-icon>
                </button>
            </div>
        </div>
      </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="toast hidden" role="alert" aria-live="polite">Action Successful</div>

    <!-- EXPORT MODAL (Hidden by default) -->
    <div id="exportModal" class="modal-overlay hidden" role="dialog" aria-modal="true">
        <div class="modal-glass">
            <h2>Export Deck</h2>
            <div class="form-group">
                <label>Filename</label>
                <input type="text" id="exportFilename" value="my_deck" />
            </div>
            
            <div class="form-group">
                <label>Format</label>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="exportFormat" value="apkg" checked>
                        <span>Anki Package (.apkg)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="exportFormat" value="txt">
                        <span>Text File (.txt)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="exportFormat" value="md">
                        <span>Markdown (.md)</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="exportFormat" value="csv">
                        <span>CSV (.csv)</span>
                    </label>
                </div>
            </div>

            <div class="modal-actions">
                <button class="action-btn secondary" id="btnCancelExport">
                    Cancel
                </button>
                <button class="action-btn secondary" id="btnPreviewExport">
                    Preview
                </button>
                <button class="action-btn primary" id="btnConfirmExport">
                    Download .apkg
                </button>
            </div>
            <div id="exportLoader" class="loader-line hidden"></div>
        </div>
    </div>

    <!-- EXPORT PREVIEW MODAL -->
    <div id="exportPreviewModal" class="modal-overlay hidden">
      <div class="modal-glass" style="max-width: 700px;">
        <h2>Export Preview</h2>
        <div class="preview-stats">
          <div class="stat-item">
            <ion-icon name="library-outline"></ion-icon>
            <div>
              <strong id="previewTotalCards">0</strong>
              <span>Total Cards</span>
            </div>
          </div>
          <div class="stat-item">
            <ion-icon name="checkmark-circle-outline"></ion-icon>
            <div>
              <strong id="previewValidCards">0</strong>
              <span>Valid Cards</span>
            </div>
          </div>
          <div class="stat-item warning">
            <ion-icon name="alert-circle-outline"></ion-icon>
            <div>
              <strong id="previewIssues">0</strong>
              <span>Issues</span>
            </div>
          </div>
        </div>
        
        <h3 style="margin-top: 24px; margin-bottom: 12px; font-size: 16px;">Sample Cards (First 5)</h3>
        <div class="preview-cards" id="previewCardsList"></div>
        
        <div class="modal-actions">
          <button class="action-btn secondary" id="btnClosePreview">Close</button>
          <button class="action-btn primary" id="btnConfirmFromPreview">Looks Good - Export</button>
        </div>
      </div>
    </div>

    <!-- KEYBOARD SHORTCUTS MODAL -->
    <div id="shortcutsModal" class="modal-overlay hidden" role="dialog" aria-modal="true">
      <div class="modal-glass">
        <h2>Keyboard Shortcuts</h2>
        <div class="shortcuts-table">
          <div class="shortcuts-section">
            <h3>Navigation</h3>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>F1</kbd></span>
              <span class="shortcut-desc">Open command palette</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Esc</kbd></span>
              <span class="shortcut-desc">Close modals / Clear command palette</span>
            </div>
          </div>
          
          <div class="shortcuts-section">
            <h3>Editing</h3>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Enter</kbd></span>
              <span class="shortcut-desc">Add card from omnibar</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>Z</kbd></span>
              <span class="shortcut-desc">Undo last action</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>Y</kbd></span>
              <span class="shortcut-desc">Redo action</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>F</kbd></span>
              <span class="shortcut-desc">Focus search</span>
            </div>
          </div>

          <div class="shortcuts-section">
            <h3>Study Mode</h3>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Space</kbd></span>
              <span class="shortcut-desc">Show answer / flip card</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>1</kbd></span>
              <span class="shortcut-desc">Rate: Again</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>2</kbd></span>
              <span class="shortcut-desc">Rate: Hard</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>3</kbd></span>
              <span class="shortcut-desc">Rate: Good</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>4</kbd></span>
              <span class="shortcut-desc">Rate: Easy</span>
            </div>
          </div>

          <div class="shortcuts-section">
            <h3>Views</h3>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>1</kbd></span>
              <span class="shortcut-desc">Library view</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>2</kbd></span>
              <span class="shortcut-desc">Study view</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>3</kbd></span>
              <span class="shortcut-desc">Statistics view</span>
            </div>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>4</kbd></span>
              <span class="shortcut-desc">Settings view</span>
            </div>
          </div>
          
          <div class="shortcuts-section">
            <h3>Help</h3>
            <div class="shortcut-row">
              <span class="shortcut-keys"><kbd>Ctrl</kbd> + <kbd>/</kbd></span>
              <span class="shortcut-desc">Show this help panel</span>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="action-btn primary" id="btnCloseShortcuts">Close</button>
        </div>
      </div>
    </div>

    <!-- COLOR PICKER MODAL -->
    <div id="colorPickerModal" class="modal-overlay hidden">
      <div class="modal-glass">
        <h2>Choose Deck Color</h2>
        <div class="color-grid">
          <button class="color-option" data-color="#6366F1" style="background: #6366F1"></button>
          <button class="color-option" data-color="#8B5CF6" style="background: #8B5CF6"></button>
          <button class="color-option" data-color="#EC4899" style="background: #EC4899"></button>
          <button class="color-option" data-color="#F43F5E" style="background: #F43F5E"></button>
          <button class="color-option" data-color="#F97316" style="background: #F97316"></button>
          <button class="color-option" data-color="#F59E0B" style="background: #F59E0B"></button>
          <button class="color-option" data-color="#84CC16" style="background: #84CC16"></button>
          <button class="color-option" data-color="#10B981" style="background: #10B981"></button>
          <button class="color-option" data-color="#14B8A6" style="background: #14B8A6"></button>
          <button class="color-option" data-color="#06B6D4" style="background: #06B6D4"></button>
          <button class="color-option" data-color="#3B82F6" style="background: #3B82F6"></button>
          <button class="color-option" data-color="#6366F1" style="background: #6366F1"></button>
        </div>
        <div class="modal-actions">
          <button class="action-btn secondary" id="btnCancelColor">Cancel</button>
        </div>
      </div>
    </div>

    <!-- GENERIC CUSTOM MODAL -->
    <div id="customModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="customModalTitle">
      <div class="modal-glass">
        <h2 id="customModalTitle">Title</h2>
        <div id="customModalContent" class="modal-content"></div>
        <div class="form-group hidden" id="customModalInputContainer">
            <input type="text" id="customModalInput" class="modal-input" autocomplete="off">
        </div>
        <div class="modal-actions">
          <button class="action-btn secondary" id="btnModalCancel">Cancel</button>
          <button class="action-btn primary" id="btnModalConfirm">Confirm</button>
        </div>
      </div>
    </div>

    <!-- Import Preview Modal -->
    <div id="importPreviewModal" class="modal hidden">
      <div class="preview-modal-content">
        <h2>ðŸ“¥ Import Preview</h2>
        
        <div class="import-stats">
          <span>Total: <strong id="importTotal">0</strong> cards</span>
        </div>
        
        <!-- Column Mapping (CSV only) -->
        <div id="columnMapping" class="hidden">
          <h3>Column Mapping</h3>
          <div class="mapping-controls">
            <div class="mapping-row">
              <label>Term Column:</label>
              <select id="termColumnSelect"></select>
            </div>
            <div class="mapping-row">
              <label>Definition Column:</label>
              <select id="defColumnSelect"></select>
            </div>
          </div>
        </div>
        
        <!-- Preview List -->
        <div class="import-preview-section">
          <h3>Preview (first 10 cards)</h3>
          <div class="import-preview-list" id="importPreviewList">
            <!-- Cards preview here -->
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="action-btn secondary" id="btnCancelImport">Cancel</button>
          <button class="action-btn primary" id="btnConfirmImport">Import Cards</button>
        </div>
      </div>
    </div>



    <!-- FIND & REPLACE MODAL -->
    <div id="findReplaceModal" class="modal-overlay hidden" role="dialog" aria-modal="true">
      <div class="modal-glass" style="max-width: 500px;">
        <h2><ion-icon name="search-outline"></ion-icon> Find & Replace</h2>
        <div class="form-group">
          <label>Find</label>
          <input type="text" id="findInput" placeholder="Search text..." autocomplete="off" />
        </div>
        <div class="form-group">
          <label>Replace with</label>
          <input type="text" id="replaceInput" placeholder="Replacement text..." autocomplete="off" />
        </div>
        <div class="form-group" style="display:flex;gap:16px;flex-wrap:wrap;">
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
            <input type="checkbox" id="findCaseSensitive"> Case sensitive
          </label>
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;">
            <input type="checkbox" id="findWholeWord"> Whole word
          </label>
          <select id="findField" style="padding:6px 10px;border-radius:6px;background:var(--bg-surface);color:var(--text-primary);border:1px solid var(--border-default);">
            <option value="both">Both fields</option>
            <option value="term">Term only</option>
            <option value="def">Definition only</option>
          </select>
        </div>
        <div class="modal-actions">
          <button class="action-btn secondary" id="btnCancelFindReplace">Cancel</button>
          <button class="action-btn primary" id="btnExecuteFindReplace">Replace All</button>
        </div>
      </div>
    </div>

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    
    <!-- Application Logic -->
    <script type="module" src="/static/js/main.js?v=6.0"></script>
  </body>
</html>
